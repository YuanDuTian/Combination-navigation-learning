# 1.概率论与数理统计基础

## 1.1 离散型随机变量

离散型随机变量不是学习的重点，概略记录：

![离散型随机变量分布律](滤波基础.assets/image-20240824171326810.png)

![离散型随机变量概率满足的条件](滤波基础.assets/image-20240824171443031-1724490908228-1.png)

![image-20240824171619148](滤波基础.assets/image-20240824171619148.png)

简单介绍三种重要的离散型随机变量：

**（1）（0—1）分布**

![（0—1）分布](滤波基础.assets/image-20240824171923097.png)

**（2）伯努利试验、二项分布**

![image-伯努利试验](滤波基础.assets/image-20240824172044839.png)

![image-20240824172219948](滤波基础.assets/image-20240824172219948.png)

![image-20240824172417024](滤波基础.assets/image-20240824172417024.png)

**（3）泊松分布**

![image-20240824172635430](滤波基础.assets/image-20240824172635430.png)

![image-20240824172801744](滤波基础.assets/image-20240824172801744.png)



![image-20240824172949527](滤波基础.assets/image-20240824172949527.png)

## 1.2 随机变量的分布函数

![image-20240824173451200](滤波基础.assets/image-20240824173451200.png)

![image-20240824173615539](滤波基础.assets/image-20240824173615539.png)



## 1.3 连续型随机变量及其概率密度 ★



![image-20240824173754603](滤波基础.assets/image-20240824173754603.png)

![image-20240824173935739](滤波基础.assets/image-20240824173935739.png)



![image-20240824181123645](滤波基础.assets/image-20240824181123645.png)

![image-20240824181132197](滤波基础.assets/image-20240824181132197.png)

![image-20240824181558208](滤波基础.assets/image-20240824181558208.png)

三种重要的连续型随机变量：

**（1）均匀分布**

![image-20240824181816950](滤波基础.assets/image-20240824181816950.png)

**（2）指数分布**

![image-20240824183640127](滤波基础.assets/image-20240824183640127.png)

![image-20240824184624291](滤波基础.assets/image-20240824184624291.png)

**(3)正态分布**

![image-20240824184711025](滤波基础.assets/image-20240824184711025.png)

![image-20240825092707495](滤波基础.assets/image-20240825092707495.png)

![image-20240825092932442](滤波基础.assets/image-20240825092932442.png)

![image-20240825093107648](滤波基础.assets/image-20240825093107648.png)

![image-20240825093149763](滤波基础.assets/image-20240825093149763.png)

## 1.4 多维随机变量及其分布

![image-20240825093621419](滤波基础.assets/image-20240825093621419.png)

![image-20240825093741557](滤波基础.assets/image-20240825093741557.png)

![image-20240825093838121](滤波基础.assets/image-20240825093838121.png)

![image-20240825093857109](滤波基础.assets/image-20240825093857109.png)

![image-20240825093955350](滤波基础.assets/image-20240825093955350.png)

![image-20240825094441865](滤波基础.assets/image-20240825094441865.png)

![image-20240825094455521](滤波基础.assets/image-20240825094455521.png)

![image-20240825094536975](滤波基础.assets/image-20240825094536975.png)

![image-20240825094550476](滤波基础.assets/image-20240825094550476.png)

![image-20240825094645121](滤波基础.assets/image-20240825094645121.png)

![image-20240825094700977](滤波基础.assets/image-20240825094700977.png)

## 1.5 随机变量的数字特征

###  1.5.1 数学期望

![image-20240825094931384](滤波基础.assets/image-20240825094931384.png)

![image-20240825095025537](滤波基础.assets/image-20240825095025537.png)

### 1.5.2 方差

![image-20240825095227168](滤波基础.assets/image-20240825095227168.png)

![image-20240825095256905](滤波基础.assets/image-20240825095256905.png)

![image-20240825095359304](滤波基础.assets/image-20240825095359304.png)

![image-20240825095439751](滤波基础.assets/image-20240825095439751.png)

### 1.5.3 协方差、矩、协方差矩阵 

![image-20240825100133234](滤波基础.assets/image-20240825100133234.png)

![image-20240825100206680](滤波基础.assets/image-20240825100206680-1724551328531-1-1724551331941-3.png)

![image-20240825100316990](滤波基础.assets/image-20240825100316990.png)

![image-20240825100450142](滤波基础.assets/image-20240825100450142-1724551493529-5-1724551495968-7.png)











## 1.6 切比雪夫不等式 及 大数定理

![image-20240825095816051](滤波基础.assets/image-20240825095816051.png)

![image-20240825095839350](滤波基础.assets/image-20240825095839350.png)



![image-20240825100044365](滤波基础.assets/image-20240825100044365.png)

![image-20240825105242769](滤波基础.assets/image-20240825105242769.png)

![image-20240825105259261](滤波基础.assets/image-20240825105259261.png)

![image-20240825105320431](滤波基础.assets/image-20240825105320431.png)

![image-20240825110526927](滤波基础.assets/image-20240825110526927.png)

![image-20240825110726130](滤波基础.assets/image-20240825110726130.png)

## 1.7 贝叶斯公式

**贝叶斯公式的实质，可以看作是新信息（新变量）对先验概率的一次更新，它能衡量出一个变量在多大程度上，受到另一个变量的影响。**

![image-20240825154450624](滤波基础.assets/image-20240825154450624-1724571892107-11.png)

![image-20240825154556996](滤波基础.assets/image-20240825154556996.png)

![image-20240825154632336](滤波基础.assets/image-20240825154632336.png)

![image-20240825154910262](滤波基础.assets/image-20240825154910262.png)

![image-20240825162340511](滤波基础.assets/image-20240825162340511.png)

![image-20240825162351114](滤波基础.assets/image-20240825162351114.png)



# 2.几种最优估计方法

![image-20240825111822889](滤波基础.assets/image-20240825111822889-1724555904901-9.png)

**在线性观测模型和服从正态分布情况下，**

**加权最小二乘估计结果与极大似然估计相同；**

**线性最小方差估计与极大验后估计相同；**

**线性最小方差估计的均方误差小于加权最小二乘估计的均方误差，只有在没有验前信息，即验前均方误差无穷大，两者均方误差才相同。**



**几种最优估计方法的估计例题**

![image-20240825165339487](滤波基础.assets/image-20240825165339487.png)

**（1）线性最小方差估计**

![image-20240825165429270](滤波基础.assets/image-20240825165429270.png)

![image-20240825165443126](滤波基础.assets/image-20240825165443126.png)

**（2）极大似然估计**

![image-20240825165540557](滤波基础.assets/image-20240825165540557.png)

**（3）极大验后估计**

![image-20240825165658895](滤波基础.assets/image-20240825165658895-1724576220785-17.png)

**（4）加权最小二乘估计**

![image-20240825165720375](滤波基础.assets/image-20240825165720375.png)





## 2.1 最小方差估计 

![image-20240825112355081](滤波基础.assets/image-20240825112355081.png)

![image-20240825154104175](滤波基础.assets/image-20240825154104175.png)

![image-20240825162607973](滤波基础.assets/image-20240825162607973.png)

![image-20240825162723907](滤波基础.assets/image-20240825162723907-1724574445498-13.png)

## 2.2 线性最小方差估计

**对于正态分布而言，最小方差估计等价于线性最小方差估计，究其原因在于两正态分布变量之间的关系总可以用线性关系来描述。但一般在任意概率分布情况下，线性最小方差估计的精度往往不如最小方差估计。**

![image-20240825162845843](滤波基础.assets/image-20240825162845843.png)

![image-20240825162942554](滤波基础.assets/image-20240825162942554.png)

## 2.3 极大似然估计

![image-20240825163204552](滤波基础.assets/image-20240825163204552.png)

![image-20240825163742828](滤波基础.assets/image-20240825163742828.png)

## 2.4 极大验后估计

**在缺乏状态X任何先验知识的情况下，极大验后估计等价于极大似然估计。**

![image-20240825164023447](滤波基础.assets/image-20240825164023447.png)

## 2.5 加权最小二乘估计

**只要噪声V是零均值，则加权最小二乘估计就是无偏的。**

**若已知噪声的方差阵Cv，则当取加权矩阵W = Cv^-1 * σ^2 （量测噪声的权阵）时，加权最小二乘估计的均方误差阵最小，此时称最优加权最小二乘估计，或称马尔可夫估计。**

![image-20240825164531972](滤波基础.assets/image-20240825164531972-1724575533133-15.png)

![image-20240825165125567](滤波基础.assets/image-20240825165125567.png)



![image-20240825165332529](滤波基础.assets/image-20240825165332529.png)

## 2.6 贝叶斯估计

![image-20240825171639214](滤波基础.assets/image-20240825171639214.png)

## 2.7 维纳滤波

![image-20240826132950314](滤波基础.assets/image-20240826132950314.png)

![image-20240826134338048](滤波基础.assets/image-20240826134338048.png)

# 3.递推最小二乘估计

**传统最小二乘的观测方程为 V = BX - L ；而量测方程写法则为 Z = HX + V ；** 

**两者实质是一样的，只是写法和叫法有点点不一样，如V ，前者叫残差，后者叫量测噪声(也许是我理解的不对)；**

![image-20240826134518709](滤波基础.assets/image-20240826134518709-1724651125544-1.png)

![image-20240826135138591](滤波基础.assets/image-20240826135138591.png)

*注：上述中的某某量头上有一横，即代表其量的累加值；*

上述文字描述出的递推最小二乘结果为：

![image-20240826140641759](滤波基础.assets/image-20240826140641759.png)

![image-20240826142357458](滤波基础.assets/image-20240826142357458.png)

**上述则为常见的递推最小二乘估计算法。也为KF滤波的基本公式。矩阵求逆引理可看附录A**

**同时，不采用矩阵求逆引理，也可以得到递推最小二乘估计算法。**

![image-20240826145105991](滤波基础.assets/image-20240826145105991.png)

![image-20240826145122105](滤波基础.assets/image-20240826145122105.png)

# 4.KF滤波方程的推导

![image-20240826152457867](滤波基础.assets/image-20240826152457867.png)

KF滤波估计的准则是：

| 误差min  ——均方误差阵min ——均方误差阵的迹min ——对迹求导得到极值进而得到Kk |
| ------------------------------------------------------------ |



## 4.1 滤波方程的推导

![image-20240826152736220](滤波基础.assets/image-20240826152736220.png)

**由上述所示，状态一步预测结果实质是求的均值；**

![image-20240826152758464](滤波基础.assets/image-20240826152758464.png)

**由上述所示，可得状态一步预测状态量的均方误差阵Pk/k-1；**

![image-20240826153028759](滤波基础.assets/image-20240826153028759.png)

![image-20240826153227017](滤波基础.assets/image-20240826153227017.png)

![image-20240826153321178](滤波基础.assets/image-20240826153321178.png)

![image-20240826153556753](滤波基础.assets/image-20240826153556753.png)

**上述中的状态量最优估计用文字表达即为：**

**当前时刻的状态一步预测值 + 修正系数矩阵Kk * 由预测值得到的量测误差Z = 最优估计**

![image-20240826153817693](滤波基础.assets/image-20240826153817693.png)

**上述中的公式为KF滤波的原始公式，之后的推导都从这一公式开始；**

![image-20240826154950486](滤波基础.assets/image-20240826154950486.png)

![image-20240826155227810](滤波基础.assets/image-20240826155227810.png)

**由上述可得，要使估计值最优，即使其误差最小；**

**而估计误差，是一随机向量，使其“误差最小”的含义规定为使各分量的均方误差之和最小，等价于均方误差的均值最小；**

**而将均方误差的均值矩阵展开，可知道其均值最小等价于其迹最小，其结果为一标量函数；**

**因此可基于预测均方误差阵，利用方阵的求迹运算，可以得到最优估计均方误差阵的迹的极值。**

![image-20240826211006527](滤波基础.assets/image-20240826211006527.png)

**由上述可知对于迹函数如何求导的方法。**

![image-20240826211647705](滤波基础.assets/image-20240826211647705.png)

**由上述可知，根据均方误差Pk的函数进行求迹运算后求导得到极值，同时求出相应的Kk。与递推最小二乘的Kk一致**。

![image-20240826211932780](滤波基础.assets/image-20240826211932780.png)

上述为KF滤波的五个基本公式，需要注意的是，随机系统状态模型为：

![image-20240826212143843](滤波基础.assets/image-20240826212143843.png)

**状态模型里的Xk不是预测值，而是相当于真值。因此方程里会有噪声矩阵**；

**对于滤波增益计算公式中的矩阵求逆问题，求逆可采用”变量循环重新编号法“和三角分解法（先采用乔累斯基分解得到下三角矩阵，再求其逆）。**

**KF滤波与递推最小二乘的关系：**

**a. 递推最小二乘关于Xk的递推方程里，采用的是上一时刻的Xk-1，而KF滤波里加入了状态一步预测这一步骤，使得将Xk-1替换为了由Xk-1预测得到得当前时刻的预测值Xk/k-1;**

**b.在计算Kk时，也是将上一时刻状态量的均方误差阵Pk-1替换为预测的当前状态量均方误差阵Pk/k-1；**

**c.递推最小二乘估计可以看作是KF滤波的一个特例，KF滤波可看作是递推最小二乘估计应用于时变状态过程的推广。**

![image-20240826224557624](滤波基础.assets/image-20240826224557624.png)

**上述给出了关于Kk和Pk的各种等价的计算公式，需要记住。**

**此外，KF滤波也能够按照递推贝叶斯原理推导获得，过程略，可看书。**

## 4.2 滤波的几何解释

![image-20240827091812446](滤波基础.assets/image-20240827091812446.png)

![image-20240827092047534](滤波基础.assets/image-20240827092047534.png)

上述描述了KF滤波又称线性最小方差无偏估计，同时其几何方式表达为正交投影性质，即状态Xk的最优估计是Xk在由上一时刻Xk-1和观测值Zk构成的线性空间上的正交投影；

同时最优估计值也是Xk在k时刻之前所有量测构成的量测空间上的正交投影，即Xk的估计误差与累积两侧观测值协方差为0，表明估计误差中不含量测的任何信息，两者不相关，也可以说KF滤波估计Xk实现了对量测Zj的所有有用信息的提取。

## 4.3 滤波流程图

![image-20240827092736155](滤波基础.assets/image-20240827092736155.png)

![image-20240827092744234](滤波基础.assets/image-20240827092744234.png)

![image-20240827092839437](滤波基础.assets/image-20240827092839437.png)

## 4.4 连续时间随机系统的离散化和连续时间KF滤波

### 4.4.1 系统方程的离散化

![image-20240827093212044](滤波基础.assets/image-20240827093212044.png)

![image-20240827093409201](滤波基础.assets/image-20240827093409201.png)

**上述所示为将连续的微分方程离散化，主要是在离散化时间间隔很短且变化不太剧烈的时候得到离散后的状态转移阵；**

![image-20240827093729501](滤波基础.assets/image-20240827093729501.png)

![image-20240827094208966](滤波基础.assets/image-20240827094208966.png)



**上述主要说明离散化后的噪声是关于高斯白噪声的线性变换，其结果仍是正态分布的随机向量。**

**它的一阶矩即均值为0；**

**当k≠j时，即讨论不同时间的噪声之间的方差时，是为0的；**

**当k=j时，假设噪声系数阵Gt在离散化时间间隔内变化也比较平缓，且状态转移不太明显时，其方差可离散表达；**

![image-20240827094356846](滤波基础.assets/image-20240827094356846.png)

![image-20240827094601679](滤波基础.assets/image-20240827094601679.png)

**上述则表示出了连续时间随即系统离散化中各个参数的具体近似值。**

![image-20240827094701368](滤波基础.assets/image-20240827094701368.png)

![image-20240827094829910](滤波基础.assets/image-20240827094829910.png)

### 4.4.2 量测方程的离散化

![image-20240827095016260](滤波基础.assets/image-20240827095016260.png)

![image-20240827095226025](滤波基础.assets/image-20240827095226025.png)

**据上述可得离散化噪声参数与连续噪声参数之间的关系式；**

**它与连续时间噪声r成正比，与采样间隔T成反比；**

**同时可看作是r在时间间隔T内的平均效果。**

![image-20240827095549327](滤波基础.assets/image-20240827095549327.png)

![image-20240827095756116](滤波基础.assets/image-20240827095756116.png)

**从上述可知，连续量测方程的离散化本质是在离散化间隔内对量测方程作平均等效处理。若离散化时间间隔越短，各参数变化越缓慢，其离散化近似程度就越高；**

**一般工程中，量测方程都是离散形式直接给出的。**

# 5.Kalman滤波的一些技术处理方法

**常规的KF滤波五大基本公式在理论上非常完美，但在实际运用中，可能得对具体模型进行处理使得噪声满足基本假设条件，或提高滤波过程中矩阵数值计算的稳定性等增强KF滤波的实用性。**

## 5.1 噪声相关条件下的KF滤波

![image-20240827100652733](滤波基础.assets/image-20240827100652733.png)

### 5.1.1 系统噪声与量测噪声相关

![image-20240827100850283](滤波基础.assets/image-20240827100850283.png)

![image-20240827101737994](滤波基础.assets/image-20240827101737994.png)

**从上述所知，当系统噪声和量测噪声存在相关性时，可设一个系数矩阵来使得新系统噪声阵W* 与量测噪声V之间不再相关；**

**同时改变了状态方程里的转移矩阵以及增加了过程控制量（Jk-1Zk-1）；**

### 5.1.2 系统噪声为有色噪声

![image-20240827104909524](滤波基础.assets/image-20240827104909524.png)

![image-20240827105025845](滤波基础.assets/image-20240827105025845.png)

![image-20240827105907558](滤波基础.assets/image-20240827105907558.png)

**从上述可知，若系统噪声中含有有色噪声，可将其与白噪声分开，并建立相应状态量加入状态方程里构成增广矩阵，并利用AR（p）模型（时间序列p阶自回归模型）进行近似。**

### 5.1.3 量测噪声为有色噪声

![image-20240827110130707](滤波基础.assets/image-20240827110130707.png)

![image-20240827110350495](滤波基础.assets/image-20240827110350495.png)

![image-20240827110359129](滤波基础.assets/image-20240827110359129.png)

![image-20240827110241878](滤波基础.assets/image-20240827110241878.png)

**上述说明了对于量测噪声为有色噪声的两种解决方法，**

**一是与系统噪声有有色噪声一样，采用状态增广法，即将有色噪声区分开来加入状态方程里构成增广矩阵进行处理；**

**二是量测求差法，即利用量测方程，将相邻前后历元的量测方程按一定方式求差，同时由于该方法会使得状态噪声与量测噪声产生相关性，也需要进行去相关性处理。**

## 5.2 序贯滤波（SKF）

**对于标准KF滤波，计算增益Kk时涉及矩阵求逆，当量测维数较高时，计算量很大，而序贯滤波(SKF)是一种将高维数量测更新降低为多个低维数量测更新的方法，能有效降低矩阵的求逆计算量。**

![image-20240827111005119](滤波基础.assets/image-20240827111005119.png)

![image-20240827111019779](滤波基础.assets/image-20240827111019779.png)

![image-20240827111144675](滤波基础.assets/image-20240827111144675.png)

![image-20240827111311108](滤波基础.assets/image-20240827111311108.png)

**从上述可知，序贯滤波与常规KF滤波不同之处在于在进行量测更新时，将量测更新分解成N个子量测更新；**

**利用预测更新的一步预测状态量和一步预测状态均方误差阵作为子量测更新的初值，进行N次递推最小二乘估计，最后结果作为KF量测更新的输出结果。**

*证明N次递推的结果与常规KF结果一致的推导省略。*

![image-20240827111646290](滤波基础.assets/image-20240827111646290.png)

**从上述可知，若N = m，即递推次数为量测方程个数，此时量测噪声方差阵Rk为对角线矩阵。**

**利用序贯滤波，在滤波增益计算中的矩阵求逆问题将转化为标量的倒数运算，有利于减少滤波计算量和增强数值计算的稳定性。**

![image-20240827111940251](滤波基础.assets/image-20240827111940251.png)

**从上述可知，若量测方程阵Rk不是对角矩阵，可以利用三角分解，如Cholesky分解，从而可得到新的量测噪声方差阵为单位对角阵。之后便可继续使用序贯滤波方法处理。**

## 5.3 信息滤波与信息融合

在多传感器系统中，各种传感器提供的信息可能具有不同的特征。

充分利用多个传感器资源，通过对各种观测信息的合理利用，将它们在时间和空间上的互补与冗余信息依据某种优化准则组合起来，实现对观测目标的最优一致性描述。

### 5.3.1 信息滤波

![image-20240827112859199](滤波基础.assets/image-20240827112859199.png)

 ![image-20240827112932747](滤波基础.assets/image-20240827112932747.png)

![image-20240827113053453](滤波基础.assets/image-20240827113053453.png)

![image-20240827141442639](滤波基础.assets/image-20240827141442639.png)

**从上述可知，信息滤波里的信息矩阵其实就是状态量的均方误差阵Pk；**

**为了避免均方误差阵可能出现不可逆的问题，可以利用矩阵求逆引理转换均方误差阵预测式的表达方式；**

**与常规KF滤波相比，信息滤波的优点在于：**

**a.其状态估计均方误差阵的初值P0可以设置为无穷大；**

**b.若系统噪声方差阵Qk的阶数小于量测噪声Rk的阶数，信息滤波的求逆计算量会相对较少些；**

**c.在信息滤波更新过程中，特别是初始阶段，若状态均方误差阵不可逆，则不能获得最优估计值，只有其可逆，才能解出。**

![image-20240827141755741](滤波基础.assets/image-20240827141755741.png)

![image-20240827142425106](滤波基础.assets/image-20240827142425106.png)

### 5.3.2 信息融合

略

## 5.4 平方根滤波

在经典KF滤波中，状态量均方误差阵Pk表示的是状态估计误差的平方。而一个数的平方在数值上需要更多的数字位数，因为为了保证滤波精度，均方误差阵的更新往往比状态量的更新需要更多的有效数据位。

**平方根滤波主要针对均方误差阵更新过程（滤波增益回路）设计，采用均方误差阵Pk的平方根进行更新，以减少数值位数和计算误差。**

**与经典KF相比，平方根滤波计算只需一半的有效数字位即可到达同样的数值精度。**

### 5.4.1 Potter平方根滤波

![image-20240827142901753](滤波基础.assets/image-20240827142901753.png)

![image-20240827143116223](滤波基础.assets/image-20240827143116223.png)

![image-20240827143248842](滤波基础.assets/image-20240827143248842.png)

![image-20240827143348173](滤波基础.assets/image-20240827143348173.png)

具体算法省略，大致思路如下：

（1）量测更新：将Kk代入Pk的量测更新公式中后，根据Cholesky分解，将各阶段的均方误差阵写为三角函数LLT，即平方根形式；代入原方程后求解可得到平方根的更新公式。

（2）时间更新：将平方根形式的均方误差阵代入PK的预测更新等式中，同时将系统噪声均方误差阵Qk也通过Cholesky分解成三角矩阵来计算。

![image-20240827143639433](滤波基础.assets/image-20240827143639433.png)

![image-20240827143702441](滤波基础.assets/image-20240827143702441.png)

平方根滤波主要应用于状态估计均方误差阵平方根的迭代更新。

平方根滤波的前提是量测为标量。

若量测为向量，则可以先采用序贯滤波方法进行预处理，将量测转化为标量形式，再使用标量量测平方根滤波方法；

若直接采用向量量测平方根滤波，则均方误差阵的量测更新和其对应的平方根滤波公式则需要改变，如下：

![image-20240827144151857](滤波基础.assets/image-20240827144151857.png)

### 5.4.2 奇异值分解滤波

具体过程省略，大致思路如下：

将平方根形式的三角阵的求逆变为对角阵的求逆，采用奇异值分解（SVD）滤波方法，大大降低计算量；

![image-20240827144902445](滤波基础.assets/image-20240827144902445.png)

将均方误差阵写为 n阶单位正交阵Uk * n阶正定对角阵 * n阶单位正交阵Uk的转置UkT的形式再进行计算...

### 5.4.3 UD分解滤波

![image-20240827145127058](滤波基础.assets/image-20240827145127058.png)

![image-20240827145145598](滤波基础.assets/image-20240827145145598-1724741506880-6.png)

### 5.4.4 平方根信息滤波（SRIKF）

![image-20240827145215091](滤波基础.assets/image-20240827145215091.png)

其他略...

## 5.5 遗忘滤波

标准KF滤波模型准确时，经过长时间滤波后，滤波的增益计算回路一般会逐渐收敛，增益Kk会减小，使得滤波器的惯性不断增大，新的量测值对状态估计的修正作用逐渐减弱。但是，若实际系统建模存在偏差，滤波器容易出现虚的过度收敛现象，均方误差阵Pk不能如实反映状态估计精度。

为了减轻过度收敛，使得状态估计能够较好地适应新的量测值变化，提出了**遗忘滤波算法，在滤波过程中设定一个略大于1的比例因子乘以系统噪声和量测噪声，刻意修改系统噪声Qk和量测噪声Rk的权重，从而减小历史信息的权重，相对而言就提高了新信息的权重，达到了减小滤波器惯性地目的。**

遗忘滤波在系统建模不准时改善了滤波性能，是一种次优滤波算法。

![image-20240827145804572](滤波基础.assets/image-20240827145804572.png)

**从上式中可看出，在系统噪声和量测噪声的均方误差阵上乘了一个比例因子，称遗忘因子，是略大于1的实数；**

**该遗忘因子的含义是，在序列最后N时刻看既往的系统噪声和量测噪声都以几何级数倍放大了，即反着看状态和量测的不确定性逐渐增大了**；

![image-20240827151024742](滤波基础.assets/image-20240827151024742.png)

![image-20240827151125523](滤波基础.assets/image-20240827151125523.png)

由上述所知，遗忘滤波的公式在形式上与当前时刻N无关，并且只需要将前一时刻状态均方误差阵乘上一个遗忘因子s，即等效扩大状态预测的不确定性，淡忘了既往的估计，而其他公式与常规KF滤波公式相同，当遍历时刻N = 1，2，3，...时，则构成了遗忘滤波递推公式。

![image-20240827151349675](滤波基础.assets/image-20240827151349675.png)

## 5.6 自适应滤波

自适应滤波的研究内容和方法相当广泛，本节仅对其中一种比较常用的方法：

**Sage- Husa 自适应滤波** 作简要介绍。

理论上，只有在随机动态系统的结构参数和噪声统计特性参数都准确已知的条件下，才能获得状态的最优估计。而实际中，以上两类参数的获取都或多或少存在一些误差，致使KF滤波的精度降低，严重时还可能引起发散。

随机系统的模型误差往往会影响到其输出，换言之，量测输出中很可能隐含了关于系统模型的某些信息，那么当系统模型参数不够准确时能否根据量测输出对部分参数进行重新估计建模呢？

1969年，Sage和Husa提出了一种自适应滤波方法，**它在进行状态估计的同时还可以通过量测输出在线实时地估计系统地噪声参数，但要对所有的噪声参数进行估计往往是不可能的，这里仅介绍实际中最常用也是比较有效的量测噪声方差阵自适应算法。**

![image-20240827152134337](滤波基础.assets/image-20240827152134337.png)

![image-20240827152257007](滤波基础.assets/image-20240827152257007.png)

**从上述可知，通过量测均方误差阵的表达式中可得到Rk的表达式，将量测误差的均方误差阵利用时间平均代替，利用等加权递推估计方法可得到Rk的估计值。**

**Rk的初值R0可根据实际情况选择为适当大的方差阵。**

![image-20240827152612689](滤波基础.assets/image-20240827152612689.png)

![image-20240827152621567](滤波基础.assets/image-20240827152621567.png)

从上述可知，随着长时间滤波后，滤波自适应能力逐渐减弱，为此，可将1/k替换为新的参数β，初值设为1。

![image-20240827152928364](滤波基础.assets/image-20240827152928364.png)

**从上述可知，为避免出现估计的量测噪声的修正项为负的情况，可采用序贯滤波方法并对估计的量测噪声对角线每个元素的大小进行限制。**

## 5.7 量测故障检测与强跟踪滤波（STKF）

略

![image-20240827153744093](滤波基础.assets/image-20240827153744093.png)

### 5.7.1 量测故障的检测与隔离

### 5.7.2 量测方差自适应滤波

![image-20240827153912361](滤波基础.assets/image-20240827153912361.png)

### 5.7.3 单重渐消因子自适应滤波

![image-20240827154132095](滤波基础.assets/image-20240827154132095.png)



![image-20240827154138588](滤波基础.assets/image-20240827154138588.png)

**从上述可知，引入自适应调整渐消因子λ，调整状态均方误差阵P，使得滤波增益Kk增大，加大了量测对状态估计的修正作用以更快地跟踪量测的变化，使用这类处理方法的滤波器常称为强跟踪KF滤波器，STKF。**

### 5.7.4 多重渐消因子自适应滤波

![image-20240827154654231](滤波基础.assets/image-20240827154654231.png)

![image-20240827154731502](滤波基础.assets/image-20240827154731502.png)

**从上述可知，如何确定经验渐消比例系数αi是强跟踪滤波的一大难题。**

### 5.7.5 基于序贯算法的多重渐消因子自适应滤波

![image-20240827154933873](滤波基础.assets/image-20240827154933873.png)

## 5.8 最优平滑算法

![image-20240827162220918](滤波基础.assets/image-20240827162220918.png)

![image-20240827162435941](滤波基础.assets/image-20240827162435941.png)

从上述可知，当估计状态的时刻与量测时刻相同时，称估计值为最优估计，而前者大于后者时，称最优预测，前者小于后者时，称最优平滑或内插。

**预测是估计的基础，而估计又是平滑的基础。**

在最优平滑算法中，若被估计状态Xj是某个固定的j时刻，则称为固定点平滑；

若被估计状态Xj与量测Zj+N之间总存在固定的时间间隔滞后值N，则称为固定滞后平滑；

若被估计状态Xj的时刻在量测时间区间内取遍所有值，则称为固定区间平滑。

**而对于固定区间平滑算法，在数据后处理技术中具有重要的应用价值。**

### 5.8.1 双向滤波算法

**固定区间平滑是指在前向KF滤波的基础上再实施反向滤波，充分利用量测区间内的所有量测值对状态进行估计，具有比单向滤波更高的估计精度。**

![image-20240827163050327](滤波基础.assets/image-20240827163050327.png)

![image-20240827163124849](滤波基础.assets/image-20240827163124849.png)

![image-20240827163241012](滤波基础.assets/image-20240827163241012.png)

![image-20240827163534209](滤波基础.assets/image-20240827163534209.png)



从上述可知，固定区间平滑是指根据被估计状态量Xj的j时刻，将所有量测信息分为前半部分和后半部分；

**前半部分采用前向滤波，跟之前传统KF滤波一致，得到被估计状态量的估计值及其均方误差阵；**

同时将状态方程改写，写成Xk与Xk+1的关系式后得到反向滤波状态空间模型；

**实际应用时假设Xk+1与系统噪声之间不相关，利用后半部分量测信息作反向滤波对Xj+1进行估计，再对Xj进行反向一步预测得到反向一步预测估计及其均方误差阵；**

![image-20240827163756178](滤波基础.assets/image-20240827163756178.png)

**从上述可知，利用前向滤波和后向滤波的估计结果，根据信息融合公式得到状态Xj的最优平滑值及其均方误差阵；**

在实际运用中，固定区间平滑算法实现步骤为：

（1）对给定的量测序列，按从前往后的顺序作正向滤波，求解并存储相应的最优估计Xk及其均方误差阵Pk；

**（2）按从后往前的量测顺序作反向滤波和预测得到相应的反向估计值Xk及其均方误差阵Pk，并每反向预测一步，就结合正向滤波中对应时刻的存储结果得到一次最优平滑及其均方误差阵；当反向执行至第一个历元便实现了整个区间的状态平滑。**

![image-20240827164530809](滤波基础.assets/image-20240827164530809.png)

**从上述可知，为解决反向滤波涉及较多求逆运算而计算量大的问题，可采用RTS固定区间平滑算法，在状态维数不高时，能够在一定程度上降低计算量。**

![image-20240827164732515](滤波基础.assets/image-20240827164732515.png)

**从上述可知，为了降低数据存储量和求逆运算，可仅保存最优估计值和均方误差阵的对角线元素，并分别以后向滤波值近似代替反向一步预测值，再进行简单加权处理得到平滑结果。**

**只有受噪声影响的状态分量才可平滑。**

## 5.9 非线性系统的滤波方法

### 5.9.1 扩展KF滤波（EKF）

对于非线性的系统，一般将其通过泰勒展开，略去高阶项后近似为线性系统后进行KF滤波估计。

![image-20240827165229696](滤波基础.assets/image-20240827165229696.png)

![image-20240827165241376](滤波基础.assets/image-20240827165241376.png)

### 5.9.1 迭代滤波

![image-20240827165556853](滤波基础.assets/image-20240827165556853.png)

**从上述可知，在滤波后，用状态估计值来替代预测值再利用量测方程进行量测预测修正和计算雅可比矩阵，有助于提高求解精度。**

![image-20240827170008206](滤波基础.assets/image-20240827170008206.png)

从上述可知大致步骤如下：

（1）按照普通EKF滤波进行预滤波，此时状态估计的均方误差阵不进行量测更新；

（2）在获得k时刻的状态估计后，通过RTS平滑算法求取其平滑值，再进行预测修正，再用其预测结果进行量测更新。

### 5.9.2 间接滤波与滤波校正

![image-20240827170246878](滤波基础.assets/image-20240827170246878.png)

从上述可知，当状态方程和量测方程均为非线性的一般情况时，原始系统可分为两部分，一是不含噪声的确定性标称子系统，二是含随机噪声的误差子系统。同时三者存在关系式。

**那么对于该非线性系统式作状态估计，可先利用标称子系统式递推获取状态量和量测值，再通过误差子系统式利用与标称子系统递推获取的状态和量测得到的误差值得到一个非线性状态估计，这样的方法称间接滤波。**

同理，线性系统也可以采用间接滤波的方法。（具体方法省略，看到这里顶不住了，之后再看）

![image-20240827170704569](滤波基础.assets/image-20240827170704569.png)

**从上述可知，间接滤波的优点在于，**

**a.对于非线性系统，通过间接滤波将其分解后，误差子系统的非线性减弱了，此时使用EKF有利于降低泰勒级数展开高阶截断误差，甚至有时误差子系统还可以近似简化成线性系统，可直接用标准KF进行估计。**

**b.对于非线性系统，通过间接滤波和校正可使误差状态变为小量，有利于保持误差子系统的弱非线性甚至线性。**

同时，弱非线性系统分解后的误差子系统式线性或近似线性的，并且采用校正系数矩阵校正过后，间接滤波方法实际上就等价于EKF。

## 5.10 联邦滤波

对于多个传感器的组合系统，如ins/GNSS/里程计/气压计组合导航系统，以惯导为主要参考导航系统，其他三种导航子系统辅助惯导，提高总体导航精度。

针对这类大系统，可以设计一个高维的综合滤波器，包含所有的状态变量，再进行KF滤波，这一处理方式通常称为集中式滤波；同时也可以采用所谓的联邦滤波方法进行分散降阶处理，**采用联邦滤波有利于降低计算量，还便于各子系统的故障诊断和隔离。**

其他略...

# 6.互补滤波

互补滤波是利用加计和陀螺仪特性进行低通和高通滤波，提高实用性，但在高动态环境下性能受限（因无法用加计准确计算角度）。

互补滤波相较KF滤波计算更简单，实时性更好，但精度不如KF滤波；

**原理是利用角度计算中加计和陀螺仪的特点，即加速度计长时间更准确，陀螺仪短时间更准确，所以对加计作低通滤波，滤掉高频噪声，对陀螺仪作高通滤波，滤掉低频噪声。**

| 所以用互补滤波法根据他们的特性取长补短进行姿态解算，每过一段时间就让加速度计去校准一下陀螺仪。互补滤波就是在短时间内采用陀螺仪得到的角度做为最优值，定时对加速度采样来的加速度值进行取平均值来校正陀螺仪的得到的角度。短时间内用陀螺仪比较准确，以它为主；长时间用加速度计比较准确，这时候加大它的比重，这就是互补了，不过加速度计要滤掉高频信号，陀螺仪要滤掉低频信号，互补滤波器就是根据传感器特性不同，通过不同的滤波器（高通或低通，互补的），然后再相加得到整个频带的信号。互补是给他们不同的权重加权求和。 |
| ------------------------------------------------------------ |




# 7.因子图













# 附录A 矩阵求逆引理

![image-20240826141700501](滤波基础.assets/image-20240826141700501.png)

![image-20240826141713836](滤波基础.assets/image-20240826141713836.png)

# 附录B 矩阵求逆 

## 方法1 变量循环重新编号法 

***参考郭显娥-程序实现对称正定矩阵的求逆***

变量循环重新编号法是一种基于高斯-约旦消元法的技巧。通过重新编号和调整消元过程中的变量顺序来减少运算中的复杂性，增加计算效率。

**常用的矩阵求逆方法如下：**

![image-20240826214749732](滤波基础.assets/image-20240826214749732.png)

由于A正定，因此a11>0 ，故可从（3）中第一个等式中解出x1（**称为交换x1和y1的位置，即等式两边除以一个a11**），再将x1带入其他等式，得到新的关系式：

![image-20240826215758853](滤波基础.assets/image-20240826215758853.png)

用同样的方法交换x2和y2的位置，如此继续，便可得到x = By, 即得到B ，也就是A的逆。

但若采用上述方法，计算量大且冗长，

**因此采用"变量循环重新编号法"，使每一步的交换都在x1和y1的位置上进行**

类似（5）的系数计算公式，即：

![image-20240826220309649](滤波基础.assets/image-20240826220309649.png)

**如a’ 22 = 1/a11、a' 2,4 = -a15/a11、a'2, 3 = a31/a11；**

![image-20240826220553393](滤波基础.assets/image-20240826220553393.png)



![image-20240826220653326](滤波基础.assets/image-20240826220653326.png)

上述所述是指将变量（x1,x2,x3,...xk,...,xn-1,xn）重新编号为(xn,x1,x2,...,xk-1,...,xn-2,xn-1);

将变量（y1,y2,y3,...yk,...,yn-1,yn）重新编号为(yn,y1,y2,...,yk-1,...,yn-2,yn-1);

**即将xn变为xn-1，x1变为xn，yn变为yn-1,y1变为yn；**

![image-20240826221538784](滤波基础.assets/image-20240826221538784.png)

## 方法2 三角分解法

**先将对称正定阵作乔莱斯基（Cholesky）三角分解，再求三角阵的逆，且三角阵的逆很容易求得。**

若A是n阶对称正定矩阵，则存在：

![image-20240826222308984](滤波基础.assets/image-20240826222308984.png)

**若限定L对角线元素为正，则该分解是唯一的，其中L为下三角矩阵。**

该公式则为对称正定矩阵A的乔累斯基（Cholesky）分解，亦称为平方根分解。

**具体解法如下：**

![image-20240826222731419](滤波基础.assets/image-20240826222731419.png)

由于A正定，因此只需要考虑下三角元素，即i≥j的情况，有：

![image-20240826222810486](滤波基础.assets/image-20240826222810486.png)

即：

![image-20240826222906033](滤波基础.assets/image-20240826222906033.png)

而且当i = j 时，有：

![image-20240826222933363](滤波基础.assets/image-20240826222933363.png)

*在求得L的第i行元素后，LT的第i列元素也已求出，所以计算量是克劳特分解的一般左右。*

同时又有：

![image-20240826223249815](滤波基础.assets/image-20240826223249815.png)

所以

![image-20240826223305173](滤波基础.assets/image-20240826223305173.png)

于是

![image-20240826223312889](滤波基础.assets/image-20240826223312889.png)

以上分析说明，分解过程中元素lik 的数量级完全可以控制，从而计算过程是稳定的。


然后上述这种LLT分解存在很大的缺陷，因为计算这种分解需要进行n次开方运算，而绝大多数计算机上的开方运算是用子程序将其转化为对数计算的，这样不仅增加了计算量，而且还会扩大误差，甚至计算过程中有平方根号下出现负数的风险。

为了避免上面的平方根运算，只需要在L和LT中间插入一个特殊的对角矩阵D，则能达到预定的效果，即LDLT分解。

![image-20240826223614791](滤波基础.assets/image-20240826223614791.png)

**上式即是对称正定矩阵A 的不带平方根乔累斯基(Cholesky)分解，亦称乔累斯基(Cholesky)分解的变形。**

**具体解法：**

![image-20240826223759692](滤波基础.assets/image-20240826223759692.png)













